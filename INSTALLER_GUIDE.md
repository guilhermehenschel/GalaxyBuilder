# Galaxy Builder - Installer and Packaging Guide

This document describes how to create installers and packages for the Galaxy Builder application.

## Overview

The Galaxy Builder project includes a comprehensive packaging system that supports multiple distribution formats:

- **Windows**: NSIS installer, portable ZIP packages, CPack packages
- **Linux**: AppImage, DEB packages, RPM packages, TAR.GZ archives
- **macOS**: DMG packages, TAR.GZ archives

## Quick Start

### Windows Portable Package (Recommended for testing)

```powershell
# Build the project
cmake --preset=windows-release
cmake --build build/windows-release --config Release

# Create portable package using the deployment script
.\deploy-windows.ps1 -BuildType Release -CreatePortable

# Or use CMake targets
cmake --build build/windows-release --target portable --config Release
```

### Windows Installer (NSIS Required)

```powershell
# Install NSIS from https://nsis.sourceforge.io/
# Then build and create installer
cmake --preset=windows-release
cmake --build build/windows-release --config Release
cmake --build build/windows-release --target installer --config Release
```

### CPack Packages

```powershell
# Create multiple package formats using CPack
cmake --build build/windows-release --target package --config Release
```

## Deployment Script Usage

The `deploy-windows.ps1` script provides comprehensive Windows deployment options:

### Parameters

- **`-BuildType`**: `Debug` or `Release` (default: `Release`)
- **`-QtDir`**: Path to Qt6 installation (auto-detected if not specified)
- **`-CreateInstaller`**: Create NSIS installer (requires NSIS)
- **`-CreatePortable`**: Create portable ZIP package
- **`-SkipDeploy`**: Skip Qt6 dependency deployment

### Examples

```powershell
# Create Release portable package
.\deploy-windows.ps1 -BuildType Release -CreatePortable

# Create Debug portable package with specific Qt6 path
.\deploy-windows.ps1 -BuildType Debug -QtDir "C:\Qt\6.9.1\msvc2022_64" -CreatePortable

# Create both installer and portable (requires NSIS)
.\deploy-windows.ps1 -BuildType Release -CreateInstaller -CreatePortable

# Just deploy Qt6 dependencies without packaging
.\deploy-windows.ps1 -BuildType Release
```

## Package Contents

### Portable Package Structure
```
GalaxyBuilder-Release-Portable.zip
├── GalaxyBuilder.exe          # Main executable
├── Qt6Core.dll               # Qt6 core library
├── Qt6Gui.dll                # Qt6 GUI library
├── Qt6Widgets.dll            # Qt6 widgets library
├── Qt6Network.dll            # Qt6 network library (for plugins)
├── Qt6Svg.dll                # Qt6 SVG support
├── platforms/                # Qt6 platform plugins
│   └── qwindows.dll          # Windows platform plugin
├── styles/                   # Qt6 style plugins
│   └── qmodernwindowsstyle.dll
├── imageformats/             # Image format plugins
│   ├── qjpeg.dll
│   ├── qpng.dll
│   └── ...
├── resources/                # Application resources
│   └── styles/
│       └── dark_theme.qss
└── README.txt               # Usage instructions
```

### Installer Features (NSIS)

- **Modern installer interface** with welcome/finish pages
- **Automatic Qt6 dependency installation**
- **Start menu shortcuts**
- **Desktop shortcut** (optional)
- **File associations** for .galaxy files
- **Uninstaller** with clean removal
- **Windows 10+ compatibility check**
- **Upgrade support** (removes old version)

## CMake Targets

The project provides several CMake targets for packaging:

### Available Targets

```bash
# Windows-specific targets
cmake --build build/windows-release --target portable    # Create portable package
cmake --build build/windows-release --target installer   # Create NSIS installer (if NSIS available)

# Cross-platform CPack targets
cmake --build build/windows-release --target package     # Create CPack packages

# Linux-specific targets (when building on Linux)
cmake --build build/linux-release --target appimage     # Create AppImage (if linuxdeploy available)
```

### Package Formats Generated by CPack

- **Windows**: ZIP archive, NSIS installer (if available)
- **Linux**: TAR.GZ archive, DEB package, RPM package
- **macOS**: TAR.GZ archive, DMG disk image

## Requirements

### Windows

- **Visual Studio 2022** with C++ build tools
- **Qt6 6.3.0+** (tested with Qt6 6.9.1)
- **CMake 3.24+**
- **NSIS 3.x** (optional, for installer creation)

### Linux

- **GCC 11+ or Clang 14+** with C++23 support
- **Qt6 6.3.0+** development packages
- **CMake 3.24+**
- **linuxdeploy** (optional, for AppImage creation)

### macOS

- **Xcode 14+** with C++23 support
- **Qt6 6.3.0+** (via Homebrew or Qt installer)
- **CMake 3.24+**

## Qt6 Dependency Deployment

The packaging system uses Qt6's official deployment tools:

- **Windows**: `windeployqt.exe` - Automatically copies Qt6 DLLs and plugins
- **Linux**: `linuxdeploy` with Qt6 plugin - Creates self-contained AppImages
- **macOS**: `macdeployqt` - Bundles Qt6 frameworks into .app bundles

### Deployment Features

- **Automatic dependency detection** based on executable
- **Platform plugin inclusion** (qwindows.dll, qxcb.so, etc.)
- **Style plugin support** for native look and feel
- **Image format plugins** (JPEG, PNG, SVG, etc.)
- **Debug/Release library selection**
- **Minimal deployment** (excludes unnecessary components)

## File Size Comparison

Typical package sizes for Galaxy Builder:

- **Debug Portable**: ~80-100 MB (includes debug symbols)
- **Release Portable**: ~25-35 MB (optimized)
- **NSIS Installer**: ~20-30 MB (compressed)
- **AppImage**: ~30-40 MB (Linux)

## Installation Instructions

### Windows Portable

1. Download `GalaxyBuilder-Release-Portable.zip`
2. Extract to any folder
3. Run `GalaxyBuilder.exe`

### Windows Installer

1. Download `GalaxyBuilder-Setup.exe`
2. Run installer as administrator
3. Follow installation wizard
4. Launch from Start Menu or Desktop

### Linux AppImage

1. Download `GalaxyBuilder-x86_64.AppImage`
2. Make executable: `chmod +x GalaxyBuilder-x86_64.AppImage`
3. Run: `./GalaxyBuilder-x86_64.AppImage`

## Distribution

### Release Assets

For GitHub releases, include these files:

```
GalaxyBuilder-1.0.0-Release-Portable.zip    # Windows portable
GalaxyBuilder-1.0.0-Setup.exe               # Windows installer
GalaxyBuilder-1.0.0-x86_64.AppImage         # Linux AppImage
GalaxyBuilder-1.0.0-win64.zip               # CPack Windows
GalaxyBuilder-1.0.0-Linux.tar.gz            # CPack Linux
```

### Package Naming Convention

- **Version**: Follows semantic versioning (1.0.0)
- **Platform**: win64, linux-x86_64, macos-x86_64
- **Type**: Portable, Setup, AppImage, etc.
- **Build**: Debug or Release (Release omitted for brevity)

## Troubleshooting

### Common Issues

1. **"Qt6 not found"**: Ensure Qt6 is installed and `Qt6_DIR` is set
2. **"NSIS not found"**: Install NSIS from https://nsis.sourceforge.io/
3. **Missing DLLs**: Run `windeployqt` manually or use deployment script
4. **Large package size**: Use Release build and exclude debug symbols

### Debugging Deployment

```powershell
# Check Qt6 deployment manually
windeployqt.exe --debug --verbose 2 GalaxyBuilder.exe

# List dependencies
dumpbin /dependents GalaxyBuilder.exe

# Check CMake configuration
cmake --build build/windows-release --target help
```

## Advanced Configuration

### Custom NSIS Installer

Edit `installer/windows/installer.nsi.in` to customize:

- Installer appearance (icons, images)
- License agreement
- Component selection
- Registry keys
- File associations

### CPack Configuration

Modify `cmake/PackagingConfig.cmake` to adjust:

- Package metadata
- Generator selection
- Installation paths
- Component grouping

## Continuous Integration

Example GitHub Actions workflow for automated packaging:

```yaml
- name: Build and Package
  run: |
    cmake --preset=windows-release
    cmake --build build/windows-release --config Release
    .\deploy-windows.ps1 -BuildType Release -CreatePortable -CreateInstaller
    
- name: Upload Artifacts
  uses: actions/upload-artifact@v3
  with:
    name: galaxy-builder-packages
    path: dist/
```

This comprehensive packaging system ensures easy distribution and installation of Galaxy Builder across all supported platforms!
